v<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Live Stream Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: black;
      }
      video {
        width: 100%;
        height: 100%;
        background: black;
      }
      #error-message {
        color: white;
        padding: 1em;
        text-align: center;
        display: none;
      }
    </style>
  </head>
  <body>
    <video id="video" controls autoplay muted playsinline></video>
    <div id="error-message">⚠️ Unable to load the live stream.</div>

    <script>
      const video = document.getElementById('video');
      const errorMsg = document.getElementById('error-message');
      const params = new URLSearchParams(window.location.search);
      const url = decodeURIComponent(params.get("src") || "");

      function showError(message) {
        console.warn(message);
        video.style.display = "none";
        errorMsg.style.display = "block";
      }

      if (!url || !url.startsWith("https://") || !url.endsWith(".m3u8")) {
        showError("Invalid or missing stream URL.");
      } else if (Hls.isSupported()) {
        const hls = new Hls();
        hls.attachMedia(video);
        hls.loadSource(url);

        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(err => {
            console.warn("Autoplay failed:", err);
            showError("Autoplay failed. Please click play.");
          });
        });

        hls.on(Hls.Events.ERROR, function (_, data) {
          if (data.fatal) {
            switch (data.type) {
              case Hls.ErrorTypes.NETWORK_ERROR:
                console.error("Fatal network error – trying to recover");
                hls.startLoad();
                break;
              case Hls.ErrorTypes.MEDIA_ERROR:
                console.error("Fatal media error – trying to recover");
                hls.recoverMediaError();
                break;
              default:
                console.error("Fatal error – cannot recover");
                showError("Stream cannot be loaded.");
                hls.destroy();
                break;
            }
          }
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', () => {
          video.play().catch(err => {
            console.warn("Native autoplay failed:", err);
            showError("Autoplay failed. Please click play.");
          });
        });
      } else {
        showError("Your browser does not support HLS.");
      }
    </script>
  </body>
</html>
